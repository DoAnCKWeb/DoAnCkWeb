{{#if message}}
<div class="alert alert-danger" role="alert">
    {{message}}
</div>
{{/if}}
<section class="vh-100 bg-image"
    style="background-image: url('https://mdbcdn.b-cdn.net/img/Photos/new-templates/search-box/img4.webp');">
    <div class="mask d-flex align-items-center h-100 gradient-custom-3">
        <div class="container h-100">
            <div class="row d-flex justify-content-center align-items-center h-100">
                <div class="col-12 col-md-9 col-lg-7 col-xl-6">
                    <div class="card" style="border-radius: 15px;">
                        <div class="card-body p-5">
                            <h2 class="text-uppercase text-center mb-5">Create an account</h2>
                            <form action="/register" method="POST">
                                <div class="mb-3">
                                    <label for="role" class="form-label">Loại người dùng</label>
                                    <select class="form-select" id="role" name="role" required>
                                        <option value="user">Người dùng</option>
                                        <option value="admin">Quản trị viên</option>
                                    </select>
                                </div>
                                <div data-mdb-input-init class="form-outline mb-4">
                                    <label class="form-label" for="form3Example1cg">Your Name</label>
                                    <input type="text" id="form3Example1cg" class="form-control form-control-lg"
                                        name="username" />
                                </div>

                                <div data-mdb-input-init class="form-outline mb-4">
                                    <label class="form-label" for="form3Example3cg">Your Email</label>
                                    <input type="email" id="form3Example3cg" class="form-control form-control-lg"
                                        name="email" />
                                </div>

                                <div data-mdb-input-init class="form-outline mb-4">
                                    <label class="form-label" for="form3Example4cg">Password</label>
                                    <input type="password" id="form3Example4cg" class="form-control form-control-lg"
                                        name="password" />

                                </div>
                                <div class="d-flex justify-content-center">
                                    <button type="submit" data-mdb-button-init data-mdb-ripple-init
                                        class="btn btn-success btn-block btn-lg gradient-custom-4 text-body">Register</button>
                                </div>

                                <p class="text-center text-muted mt-5 mb-0">Have already an account? <a href="/login"
                                        class="fw-bold text-body"><u>Login here</u></a></p>

                            </form>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const emailInput = document.getElementById("form3Example3cg"); // Ô input email
    const messageDiv = document.createElement("div"); //  thông báo
    messageDiv.classList.add("alert", "mt-2"); 
    messageDiv.style.display = "none"; // Ẩn thông báo 
    emailInput.parentElement.appendChild(messageDiv);

    // Lắng nghe sự kiện nhập vào ô email
    emailInput.addEventListener("input", async () => {
      const email = emailInput.value.trim();

      if (!email || !email.includes("@gmail.com")) {
        messageDiv.textContent = "Email không hợp lệ. Vui lòng sử dụng @gmail.com.";
        messageDiv.classList.add("alert-danger"); // Thông báo lỗi 
        messageDiv.classList.remove("alert-success");
        messageDiv.style.display = "block"; // Hiển thị thông báo
        return; 
      }

      try {
        const response = await fetch("/check-email", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ email }), // Gửi email
        });

        const result = await response.json();

        // Hiển thị thông báo dựa trên kết quả
        if (result.exists) {
          messageDiv.textContent = result.message || "Email đã tồn tại!";
          messageDiv.classList.add("alert-danger"); // Thông báo lỗi (màu đỏ)
          messageDiv.classList.remove("alert-success");
          messageDiv.style.display = "block"; // Hiển thị thông báo
        } else {
          messageDiv.textContent = result.message || "Email hợp lệ.";
          messageDiv.classList.add("alert-success"); // Thông báo thành công
          messageDiv.classList.remove("alert-danger");
          messageDiv.style.display = "block"; // Hiển thị thông báo
        }
      } catch (error) {
        console.error("Error checking email:", error);
      }
    });
  });
</script>
